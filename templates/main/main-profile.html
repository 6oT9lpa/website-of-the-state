<div class='all-content'>
    {% if access_denied %}
        <script>
        showAccessDenied();
        </script>
    {% endif %}

    <div class="container">
        <div class="profile-card">
            <div class="profile-header">
                <div class="avatar">
                    <img src="{{ url_for('static', filename='img/ava.png')}}">
                    <span>edit</span>
                </div>
                <div class="profile-info">
                    <div class="profile-info-row">
                        <div class="profile-info-label"><p>NIK NAME</p></div>
                        <div class="profile-info-value"><p>{{ nickname }}</p></div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-label"><p>RANK</p></div>
                        <div class="profile-info-value"><p>{{ rank }} | {{ rank_name }}</p></div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-label"><p>ORGAN</p></div>
                        <div class="profile-info-value"><p>{{ organ }}</p></div>
                    </div>
                    <a class="profile-audit" href="#">me audit</a>
                </div>
            </div>
        </div>
    </div>
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <form id="passwordForm" method="POST" action="{{ url_for('main.profile') }}">
                {{ form.hidden_tag() }}
                {{ form.oldpass.label }} {{ form.oldpass }}<br><br>
                {{ form.newpass.label }} {{ form.newpass }}<br><br>
                {{ form.submit }}
            </form>
            <div id="responseMessage"></div>
        </div>
    </div>
<script>
    var modal = document.getElementById('passwordModal');
    var link = document.getElementById('changePasswordLink');
    var span = document.getElementsByClassName('close')[0];
    var form = modal.querySelector('form');
    window.onload = function() {
            if (window.location.hash === '#changepassword') {
                modal.style.display = 'block';
        }
    };
    // Открываем модальное окно при клике на ссылку
    link.onclick = function() {
        modal.style.display = 'block';
    }

        // Закрываем модальное окно при клике на крестик
    span.onclick = function() {
        modal.style.display = 'none';
    }
    document.getElementById('passwordForm').addEventListener('submit', function(event) {
        event.preventDefault();  // Предотвращаем стандартное поведение формы

        console.log('Submitting form...');  // Выводим сообщение в консоль для отладки

        fetch(this.action, {
            method: 'POST',
            body: new FormData(this)
        }).then(response => {
        console.log('Response status:', response.status);  // Выводим статус ответа
        return response.json().then(data => ({ status: response.status, body: data }));
        }).then(obj => {
            console.log('Response body:', obj.body);  // Выводим тело ответа
            const responseMessage = document.getElementById('responseMessage');
            if (obj.status === 200) {
                responseMessage.textContent = 'Пароль изменен';
                responseMessage.style.color = 'green';
            } else {
                responseMessage.textContent = obj.body.message;
                responseMessage.style.color = 'red';
            }
        }).catch(error => {
            console.error('Error:', error);
            const responseMessage = document.getElementById('responseMessage');
            responseMessage.textContent = 'Произошла ошибка при отправке запроса';
            responseMessage.style.color = 'red';
        });
        document.getElementById('passwordForm').reset();
    });
        // Закрываем модальное окно при клике вне его
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
</script>
    <div class="MessangerWindow">
        <div class="MessangerHeader">
            <div style="background-color:{{ color }} !important;" class="organ">
                {{ organ }}
            </div>
            <div class="MessageUser">
                {{ nickname }}
            </div>

            <div class="CloseBtn">
                <span class="modal-close">&times;</span>
            </div>
            
        </div>
        <div class="MessangerContent" style="display: none;">

            <div class="MessangerAside">
                <div class="ChatUsers">
                    <div class="User">Naum Goodman</div>
                </div>
            </div>

            <div class="MessangerChatWindow">
                <div class="ChatSection">
                </div>
            </div>
        </div>
        
    </div>

    <div class="notifications">
        <div class="notification warning">Вы вызваны в суд</div>
        <div class="notification danger">У вас запрет на увольнение</div>
        <div class="notification danger">У вас судебный штраф</div>
        <button class="more-btn">see more</button>
    </div>
</div>
