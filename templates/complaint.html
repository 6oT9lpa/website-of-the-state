<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/doc-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animation-bg.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/complaint-style.css') }}">
    <title>Исковое заявление</title>
</head>
<body>
    {% block header %}
        {% include 'header/header-doc.html' %}
    {% endblock %}

    {% set user = Users.query.filter_by(static=district.created).first() %}
    {% set guest = guestUsers.query.filter_by(static=district.created).first() %}

    <div class='container-complaint'>
        <div class='main-content-complaint'>
            <div class='header-content'>
                <div class='header-statement'>
                    <div class='img-header'><img src="{{ url_for('static', filename='img/DistrictCourt.png') }}"/></div>     
                    <div class='text-header'>
                        <h4>District Court of the State of San Andreas</h4>
                        <p>Plaintiff: <b>{{ user.nikname if user else (guest.nikname if guest else 'Не найден') }}</b></p>
                        <p>Attorney for the Plaintiff: <b></b></p>
                        <p style="width: 90%;font-size: 16px;font-weight: 700;"> v. </p>
                        <div class='content-defendant'>
                            <p>Defendant:
                                {% for item in defendant %}
                                <p><b> {{ item }}, </b></p>
                                {% endfor %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class='description-content'>
                <h3>Исковое заявление № {{ "%03d" | format(district.id) }}</h3>
                <p style='text-align: center;'>Я, гражданин Соединенных штатов Америки, пользуясь своими правами подаю исковое заявление в Окружной суд штата Сан-Андреас,
                     объясняя всю ситуацию, а также прилагая все необходимые суду доказательства.</p>
                
                <p>{{ district.discription }}</p>

                <h4>Исковые требования.</h4>
                {% for item in claims %}
                    <p>{{ loop.index }}. {{ item }}</p>
                {% endfor %}
            </div>
            <div class='footer-content'>
                <p>Дата: {{ createat }}</p>
                <p style='margin-top: -5px;'>Подпись: <b style='font-family:Updock;font-size: 30px;'>
                    {{
                        (user.nikname.split()[1][0] + '. ' + user.nikname.split()[0] if user.nikname.split()|length > 1 else user.nikname) if user 
                        else 
                        (guest.nikname.split()[1][0] + '. ' + guest.nikname.split()[0] if guest.nikname.split()|length > 1 else guest.nikname)
                    }}
                </b></p>
            </div>
        </div>
        <div class="sidebar-container">
            <div class='content-sidebar'>
                <div class='header-sidebar'>
                    <h4>Статуc: </h4>
                    <p>
                        {{
                            {
                                'Waitting': 'В ожидании',
                                'Accepted': 'В работе у Прокуратуры',
                                'Rejectioned': 'Отказано',
                                'LeftMoved': 'Оставлено без движения',
                                'CourtHearing': 'Назначено заседание'
                            }.get(district.status, 'Неизвестный статус')
                        }}
                    </p>
                </div>
                {% if not district.status in ['Rejectioned', 'LeftMoved'] %}
                <div class='block-btn'>
                    {% if status == 'Judge' %}
                        {% if district.status == 'Waitting' %}
                        <div class='submit-btn-contanier'>
                            <div class='submit-btn'>
                                <input type="submit" class='accept-judge' value="Обработка иска">   
                            </div>   
                        </div> 
                        {% endif %}
                    {% endif %}
                    {% if status and status != 'Judge' %}
                    <button id="hodataistvo" onclick="openModalisk('Modalhod')" >Hitler</button>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% if status != 'Waitting' %}
        {% for order in orders_data %}
        <div class='container-position-order'>
            <div class='contanier-court-order'>
                <div class='header-content-order'>
                    <div class='img-header-order-1'><img src='{{ url_for("static", filename="img/emblem_court.png")}}'/></div>
                    <h4>DISCRICT COURT</h4>
                    <h5>state of San-Andreas</h5>

                    <div class='img-header-order-2'><img src='{{ url_for("static", filename="img/text_separator.png")}}'/></div>

                    <div class='title-court-order'>
                        <div class='group-order'>
                            <div class='content-Plaintiff'>
                                <p>Plaintiff: <b>{{ user.nikname if user else (guest.nikname if guest else 'Не найден') }}</b></p>
                                <p>Attorney for the Plaintiff: <b>{{ user.nikname if user else (guest.nikname if guest else 'Не найден') }}</b></p>
                            </div>
                        </div>
                        
                        <div class='title'>
                            <h4>No. DC-{{ "%03d" | format(district.id) }}-2024 (NM)</h4>
                            <h4> ОПРЕДЕЛЕНИЕ No. DC-{{ "%03d" | format(district.id) }}-{{ "%02d" | format(loop.index) }} </h4>
                        </div>

                        <div class='group-order'>
                            <div class='content-Defendant'>
                                <p>Attorney for the Defendant: <b>{{ user.nikname if user else (guest.nikname if guest else 'Не найден') }}</b></p>
                                <p>Defendant:
                                    {% for item in defendant %}
                                    <p><b> {{ item }}, </b></p>
                                    {% endfor %}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class='img-header-order-2'><img src='{{ url_for("static", filename="img/text_separator.png")}}'/></div>
                </div>
                <div class='main-content-order'>
                    <h4>ОБСТОЯТЕЛЬСТВА</h4>
                    <div class='findings'> <p>{{ order.findings }}</p> </div>

                    <div class='img-header-order-2'><img src='{{ url_for("static", filename="img/text_separator.png")}}'/></div>

                    <h4>РАССМОТРЕНИЕ</h4>
                    <div class='consideration'> <p>{{ order.consideration }}</p> </div>

                    <div class='img-header-order-2'><img src='{{ url_for("static", filename="img/text_separator.png")}}'/></div>

                    <h4>ОПРЕДЕЛЕНИЕ</h4>
                    <div class='ruling'> 
                        {% for item in order.ruling %}
                            <p>{{ loop.index }}. {{ item }}</p><br>
                        {% endfor %}
                    </div>
                </div>
                <div class='footer-content'>
                    <p style='margin-top: -5px;'>Подпись: <b style='font-family:Updock;font-size: 30px;'>
                        {{
                            (user.nikname.split()[1][0] + '. ' + user.nikname.split()[0] if user.nikname.split()|length > 1 else user.nikname) if user 
                            else 
                            (guest.nikname.split()[1][0] + '. ' + guest.nikname.split()[0] if guest.nikname.split()|length > 1 else guest.nikname)
                        }}
                    </b></p>
                </div>
            </div>
        </div>
        {% endfor %}
    {% endif %}

    {% for reply in repltoisk %}
    {% if reply.type_doc == "hodataistvo" %}
    <div class='hodataistvo-complaint'>
        <div class='main-content-complaint'>
            <div class='header-content'>
                <div class='header-statement'>
                    <div class='img-header'><img src="{{ url_for('static', filename='img/DistrictCourt.png') }}"/></div>     
                    <div class='text-header'>
                        <h4>District Court of the State of San Andreas</h4>
                        <p>От: <b>{{ user.nikname if user else (guest.nikname if guest else 'Не найден') }}</b></p>
                        <p>Кому: <b>Окружному Суду Штата Сан-Андреас</b></p>
                    </div>
                </div>
            </div>
            <div class='description-content'>
                <h3>Ходатайство №{{ reply.replyik['№_hodataistva'] }}</h3>
                {% if reply.replyik['type_hodataistva'] == "freeform" %}<p style='text-align: center;'>Я, гражданин Соединенных штатов Америки, ходатайствую о: {{ reply.replyik['texthod'] }}.</p>{% endif %}
                {% if reply.replyik['type_hodataistva'] == "svidetel" %}<p style='text-align: center;'>Я, гражданин Соединенных штатов Америки, ходатайствую о: привлечении свидетеля {{ reply.replyik['svidetelname'] }} к делу, так как его показания имеют важное значение для справедливого разрешения данного дела. Сведения, которыми обладает свидетель, могут существенно повлиять на исход рассмотрения дела и обеспечить всестороннее и объективное исследование всех обстоятельств дела.</p>{% endif %}
                {% if reply.replyik['type_hodataistva'] == "expert" %}<p style='text-align: center;'>Я, гражданин Соединенных штатов Америки, ходатайствую о: привлечии к делу эксперта по {{ reply.replyik['experttype'] }}, так как его знания и опыт очень важны для правильного решения. Он может предоставить информацию, которая поможет всесторонне рассмотреть все аспекты дела и принять справедливое решение.</p>{% endif %}
                {% if reply.replyik['type_hodataistva'] == "otvod" %}<p style='text-align: center;'>Я, гражданин Соединенных штатов Америки, ходатайствую об: {{ reply.replyik['texthod'] }}.</p>{% endif %}
            </div>
            <div class='footer-content'>
                <p>Дата: {{ reply.create_at }}</p>
                <p style='margin-top: -5px;'>Подпись: <b style='font-family:Updock;font-size: 30px;'>
                    {{
                        (user.nikname.split()[1][0] + '. ' + user.nikname.split()[0] if user.nikname.split()|length > 1 else user.nikname) if user 
                        else 
                        (guest.nikname.split()[1][0] + '. ' + guest.nikname.split()[0] if guest.nikname.split()|length > 1 else guest.nikname)
                    }}
                </b></p>
                {% if status == 'Judge' %}
                <button class="buttonisk" onclick="openModalisk('modal-processing-hodataistvo')">Рассмотрение</button>
                {% endif %}
            </div>
        </div>
    </div>
            {% endif %}

    {% endfor %}


    <div class='modal-processing-complaint' style='display:none;'>
        <form method='POST' action='/create_court_order'>
            <input type="hidden" name="uid" id="uid">
            <div class='content-modal'>
                <div class="header-modal">
                    <span class="btn-modal-close" id="btn-modal-close">&times;</span>
                    <div class="dropdown">
                        <button class="dropdown-btn">Действия</button>
                        <div class="dropdown-menu">
                            <a name='accept' data-action="accept">Принять иск</a>
                            <a name='reject' data-action="reject">Отказать в иске</a>
                            <a name='hold' data-action="hold">Оставить без движения</a>
                        </div>
                    </div>
                </div>
                <input type="hidden" name="action" id="action">
                <div class='form-control'>
                    <label for="findings">Обстоятельства.</label>
                    <div class='form-textarea'>
                        <textarea id="findings" name="findings" rows="8" cols="90" placeholder='Опишите обстоятельства'></textarea>
                    </div>
                </div>
                <div class='form-control'>
                    <label for="consideration">Рассмотрение.</label>
                    <div class='form-textarea'>
                        <textarea id="consideration" name="consideration" rows="8" cols="90" placeholder='Опишите мотивирвнное решение при рассмотрение искового заявления'></textarea>
                    </div>
                </div>
                <div class='form-control'>
                    <label for="decision">Определил.</label>
                    <div class='group-decision'> 
                    </div>
                    <div class='group-btn-decision'>
                        <a class='btn-add-input'>Добавить пункт</a>
                    </div>
                </div>

                <div class='submit-btn-contanier'>
                    <div class='submit-btn'>
                        <input type="submit" value="Оставить ответ">   
                    </div>   
                </div> 
            </div> 
        </form>
    </div>

    <div class='modal-processing-hodataistvo' id='modal-processing-hodataistvo'>
        <form method='POST' action='{{ url_for("main.claim_state") }}'>
            <input type="hidden" name="typeopr" value="hodataistvorasm">
            <div class='content-modal'>
                <div class="header-modal">
                    <span class="btn-modal-close" id="btn-modal-close" onclick="closeModalisk('modal-processing-hodataistvo')">&times;</span>
                    <div class="dropdown">
                        <select class="dropdown-btn" name="accepted">
                            <option value="True">Принять ходатайство</option>
                            <option value="False">Отказать</option>
                        </select>
                    </div>
                </div>
                <div id="first_page_hod">
                <input type="hidden" name="action" id="action">
                <div class='form-control'>
                    <label for="findings">Обстоятельства.</label>
                    <div class='form-textarea'>
                        <textarea id="findings" name="findings" rows="8" cols="90" placeholder='Опишите обстоятельства'></textarea>
                    </div>
                </div>
                <div class='form-control'>
                    <label for="consideration">Рассмотрение.</label>
                    <div class='form-textarea'>
                        <textarea id="consideration" name="consideration" rows="8" cols="90" placeholder='Опишите мотивирвнное решение при рассмотрение искового заявления'></textarea>
                    </div>
                </div>
                <div class='form-control'>
                    <label for="decision">Определил.</label>
                    <div class='group-decision'> 
                    </div>
                    <div class='group-btn-decision'>
                        <a class='btn-add-input'>Добавить пункт</a>
                    </div>
                </div> 
                <div class='submit-btn-contanier'>
                    <div class='submit-btn'>
                        <button onclick="togglePage(2)">Далее</button>
                    </div>  
                </div>
                </div>
                <div id="second_page_hod" style="display: none;">
                    <label>
                    <input type="checkbox" onchange="toggleForm('otvodform')"> Отвод
                    </label>
                    <select id="otvodform" name="otvodsel" style="display: none;" disabled>
                        {% for defend in isk.defendant %}
                        <option value="defendant-{{ defend }}">Ответчик {{ defend }}</option> {% endfor %}
                        {% if isk.otherme %}
                        <option value="otherme-{{ value }}"> {% for index, value in isk.otherme.items() %} {{ index }}: {{ value }}</option> {% endfor %}{% endif %}
                        <option value="judge-{{ isk.judge }}">Судья {{ isk.judge }}</option>
                        {% if isk.prosecutor %}<option value="prosecutor-{{ isk.prosecutor }}">Прокурор {{ isk.prosecutor }}</option>{% endif %}
                    </select>
                    <label>
                        <input type="checkbox" onchange="toggleForm('dateform')"> Продлить сроки расследования
                    </label>
                    <input type="date" id="dateform" name="newdateinv" style="display: none;" disabled>
                    <label>
                        <input type="checkbox" onchange="toggleForm('experttform')"> Привлечь эксперта
                    </label>
                    <input type="text" id="experttform" name="expertt" placeholder="Введите Имя Фамилию Статик эксперта" style="display: none;" disabled>
                    <label>
                        <input type="checkbox" onchange="toggleForm('svidetelform')"> Привлечь эксперта
                    </label>
                    <input type="text" id="svidetelform" name="svidetel" placeholder="Введите Имя Фамилию Статик свидетеля" style="display: none;" disabled>
                    <div class='submit-btn-contanier'>
                        <div class='submit-btn'>
                            <input type="submit" value="Оставить ответ">   
                        </div>   
                    </div>
                    <div class='submit-btn-contanier'>
                        <div class='submit-btn'>
                            <button onclick="togglePage(1)">Назад</button>
                        </div>  
                    </div>
                </div>
                </div> 
            </div> 
        </form>
    </div>
    
    {% block footer %}
        {% include 'footer/footer.html' %}
    {% endblock %}
    <div class="overlay" id='overlay'></div>
    <div class="lines">
        {% for i in range(40) %}
          <div class="line"></div>
        {% endfor %}
    </div>

    
    {% with messages = get_flashed_messages() %}
    {% if messages %} 
    <div id="access-message" class='access-message'>
        <span class="modal-close-error">&times;</span>
        <p><strong>Внимание!</strong> {{ messages[0] }}<p>
        {% if not current_user.is_authenticated %} 
            <br>
            <a class='alert-button' href="{{ url_for('main.auth') }}">Войти в аккаунт</a>
        {% endif %}
    </div> <script src="{{ url_for('static', filename='js/script-error.js') }}" ></script>
    {% endif %}
    {% endwith %}

    <div id="Modalhod" class="modalci">
        <div class="modalci-content">
            <span class="close-btn" onclick="closeModalisk('Modalhod')">&times;</span>
            <h2 id="modalHeader">Подача ходатайства</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
                  {% if messages %}
                    <ul class=flashes>
                    {% for category, message in messages %}
                      <li class="{{ category }} errorli">{{ message }}</li>
                    {% endfor %}
                    </ul>
                  {% endif %}
                {% endwith %}
            <form id="iskcForm" method="POST" action="{{ url_for('main.claim_state') }}">
                <input type="hidden" name="typeopr" value="hodataistvo">
                <h3>Ходатайство <select id="type_hodataistva" name="type_hodataistva" onchange="updateContent()">
                    <option value="freeform">Свободная форма</option>
                    <option value="svidetel">Об привлечении свидетеля</option>
                    <option value="expert">Об привлечении эксперта</option>
                    <option value="otvod">Об отводе</option>
                </select></h3>
                <div id="svidetel" class="contenthod" style="display: none;">
                    <label for="svidetelname">Имя фамилия:</label>
                    <input type="text" id="svidetelname" name="svidetelname" placeholder="Введите имя фамилию свидетеля"> 
                </div>
                <div id="expert" class="contenthod" style="display: none;">
                    <label for="experttype">Тип эксперта:</label>
                    <input type="text" id="experttype" name="experttype" placeholder="Введите тип эксперта"> 
                </div>
                <div id="otvod" class="contenthod" style="display: none;">
                    <label for="otvodnick">Отвод</label>
                    <select id="otvodnick" name="otvodselecti">
                        {% for defend in isk.defendant %}
                        <option value="defendant-{{ defend }}">Ответчик {{ defend }}</option> {% endfor %}
                        {% if isk.otherme %}
                        <option value="otherme-{{ value }}"> {% for index, value in isk.otherme.items() %} {{ index }}: {{ value }}</option> {% endfor %}{% endif %}
                        <option value="judge-{{ isk.judge }}">Судья {{ isk.judge }}</option>
                        {% if isk.prosecutor %}<option value="prosecutor-{{ isk.prosecutor }}">Прокурор {{ isk.prosecutor }}</option>{% endif %}
                    </select> 
                </div>
                <div id="freeform" class="contenthod">
                    <label for="texthod">Текст:</label>
                    <input type="text" id="texthod" name="texthod" placeholder="Введите текст ходатайства"> 
                </div>
                <label for="investigation">Срок расследования:</label>
                <input type="text" id="investigation" name="investigation">
                <input type="submit" value="Отправить">                
            </form>
            <div id="responseMessage"></div>
        </div>
    </div>

    <script>
        function updateContent() {
            const allContent = document.querySelectorAll('.contenthod');
            allContent.forEach(function(content) {
                content.style.display = 'none';
            });

            const selectedValue = document.getElementById('type_hodataistva').value;

            const selectedContent = document.getElementById(selectedValue);
            if (selectedContent) {
                selectedContent.style.display = 'block';
            }
        }
        
        var status = {{ status | tojson }};
        const urlParams = new URLSearchParams(window.location.search);
        const uid = urlParams.get('uid');
        document.getElementById('uid').value = uid;

        function openModalisk(modalid) {
            document.getElementById(modalid).style.display = "flex";
        }
        function closeModalisk(modalid) {
        document.getElementById(modalid).style.display = "none";
    }
    function toggleForm(inputId) {
    const inputElement = document.getElementById(inputId);
    if (inputElement.disabled) {
        inputElement.disabled = false;
        inputElement.style.display = "block";
    } else {
        inputElement.disabled = true;
        inputElement.style.display = "none";
    }
}
    function togglePage(number) {
    event.preventDefault();
    if (number === 2) {
        document.getElementById('first_page_hod').style.display = "none";
        document.getElementById('second_page_hod').style.display = "block";
    } else if (number === 1) {
        document.getElementById('first_page_hod').style.display = "block";
        document.getElementById('second_page_hod').style.display = "none";
    }
    }

    </script>
    <script src="{{ url_for('static', filename='js/script-complaint.js')}}"></script>
</body>
</html>
